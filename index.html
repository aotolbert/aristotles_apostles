<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Who's your Government?</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="#">
            <h3>Who's My Government?</h3>
        </a>
        <div class="nav" id="navbarNav">
            <ul class="nav justify-content-end">
                <li class="nav-item">
                <a class="nav-link active" href="#">Poll Locator</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="#">About Us</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="#">Contact</a>
                </li>
            </ul>
        </div>
    </nav>
        
    <!-- Image Section -->
    <div class="image-section">
        <img src="assets/images/capitol1_image.jpg" class="content-image">

        <div class="img-box mr-auto ml-auto">
            <h2 class="img-box-content">FIND OUT ABOUT YOUR LOCAL POLITICIANS</h2>
        </div>
    </div>
        
    <!-- Form Section -->
    <div class="container mt-5">
        <div class="row">
            <div class="col-sm-6">
                    <form class="mb-5" id="form">
                            <div class="form-group">
                                <label for="addressline1">Address 1</label>
                                <input type="text" class="form-control" id="addressline1" placeholder="Enter street address">
                            </div>
                            <div class="form-group">
                                <label for="addressline2">Address 2</label>
                                <input type="text" class="form-control" id="addressline2" placeholder="Optional">
                            </div>
                            <div class="form-row">
                                    <div class="form-group col-md-6">
                                        <label for="inputCity">City</label>
                                        <input type="text" class="form-control" id="inputCity">
                                    </div>
                                    <div class="form-group col-sm-4">
                                            <label for="states">State</label>
                                            <select class="form-control" id="states">
                                                    <option value="">N/A</option>
                                                    <option value="AL">Alabama</option>
                                                    <option value="AK">Alaska</option>
                                                    <option value="AZ">Arizona</option>
                                                    <option value="AR">Arkansas</option>
                                                    <option value="CA">California</option>
                                                    <option value="CO">Colorado</option>
                                                    <option value="CT">Connecticut</option>
                                                    <option value="DC">District of Columbia</option>
                                                    <option value="DE">Delaware</option>
                                                    <option value="FL">Florida</option>
                                                    <option value="GA">Georgia</option>
                                                    <option value="HI">Hawaii</option>
                                                    <option value="IA">Iowa</option>
                                                    <option value="ID">Idaho</option>
                                                    <option value="IL">Illinois</option>
                                                    <option value="IN">Indiana</option>
                                                    <option value="KS">Kansas</option>
                                                    <option value="KY">Kentucky</option>
                                                    <option value="LA">Louisiana</option>
                                                    <option value="MA">Massachusetts</option>
                                                    <option value="MD">Maryland</option>
                                                    <option value="ME">Maine</option>
                                                    <option value="MI">Michigan</option>
                                                    <option value="MN">Minnesota</option>
                                                    <option value="MO">Missouri</option>
                                                    <option value="MS">Mississippi</option>
                                                    <option value="MT">Montana</option>
                                                    <option value="NC">North Carolina</option>
                                                    <option value="ND">North Dakota</option>
                                                    <option value="NE">Nebraska</option>
                                                    <option value="NH">New Hampshire</option>
                                                    <option value="NJ">New Jersey</option>
                                                    <option value="NM">New Mexico</option>
                                                    <option value="NV">Nevada</option>
                                                    <option value="NY">New York</option>
                                                    <option value="OH">Ohio</option>
                                                    <option value="OK">Oklahoma</option>
                                                    <option value="OR">Oregon</option>
                                                    <option value="PA">Pennsylvania</option>
                                                    <option value="PR">Puerto Rico</option>
                                                    <option value="RI">Rhode Island</option>
                                                    <option value="SC">South Carolina</option>
                                                    <option value="SD">South Dakota</option>
                                                    <option value="TN">Tennessee</option>
                                                    <option value="TX">Texas</option>
                                                    <option value="UT">Utah</option>
                                                    <option value="VA">Virginia</option>
                                                    <option value="VT">Vermont</option>
                                                    <option value="WA">Washington</option>
                                                    <option value="WI">Wisconsin</option>
                                                    <option value="WV">West Virginia</option>
                                                    <option value="WY">Wyoming</option>
                                            </select>
                                        </div>
                                    <div class="form-group col-md-2">
                                        <label for="inputzip">Zip</label>
                                        <input type="text" class="form-control" id="inputzip">
                                    </div>
        
                            </div>  
                            <button type="submit" class="btn btn-primary" id="submit">Submit</button>
                            <button type="submit" class="btn btn-secondary" id="submitajax2">Sumbit OSAjax</button>
                            <button type="submit" class="btn btn-secondary" id="submitajax">Submit ProP Ajax</button>

                        </form>
            </div>

            <div class="col-sm-6 justify-content-end">
                <div class="mr-auto ml-auto mb-5" id="map"></div>
            </div>            
        </div>
    </div>

    <div class="container" id="dumpsite">
                
    </div> 
    
    
<!-- Footer Content -->
<div class="container-fluid mt-5 text-center" id="footer1">
    <div class="row bg-light">
        <div class="col-sm-6">
            <img src="assets/images/brand_img.jpg" href="brand image">
        </div>
        <div class="col-sm-6">
            <ul class="nav flex-column">
                <li class="footer-header">
                    <h4>For More Information</h4>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Poll Locator</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Contact</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">About Us</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="copyright col-sm-12">
            Arostotles Apostles 2018
        </div>
    </div>
</div>
        



<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4Pa8hRs34M7iiaRMeUylEBAh6nyiNfB8&callback=initMap">
</script>
<script>

var maploaded = false;

var stateInput = "";

var latitude;

var longitude;

var address;

var PPAPIKey = "TQ2hslbjh61kVID2GwEOjzuQ8BzIauJScUHBfzJa";

var OSAPIKey = "61090add-67ca-4358-841d-7983d3231aa0";

var addressquery = "";

function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 3.5,
            center: {lat: 39.8283, lng: -98.5795}
        });
        var geocoder = new google.maps.Geocoder();

        $("#submit").on("click", function(instance) {
            instance.preventDefault();

            getaddress();

            geocodeAddress(geocoder, map);
            
    });

};

function getaddress(event) {
    $("#dumpsite").empty()
    console.log($("#addressline1").val());
    console.log($("#addressline2").val());
    console.log($("#inputCity").val());
    console.log($("#states").val());
    console.log($("#inputzip").val());
    addressquery = $("#addressline1").val() + " " + $("#addressline2").val() + " " +  $("#inputCity").val() + " " +  $("#states").val() + " " +  $("#inputzip").val();
    console.log(addressquery);

}

 function geocodeAddress(geocoder, resultsMap) {
        // address = document.getElementById('address').value;
        geocoder.geocode({'address': addressquery}, function(results, status) {
            console.log(results);
            console.log(results[0].geometry.bounds);
                longitude = (results[0].geometry.viewport.b.b);
                console.log(longitude);
                latitude = (results[0].geometry.viewport.f.f); 
                console.log(latitude);
                // var dynamicstateInput = results[0].address_components[6].short_name;
                // stateInput = dynamicstateInput;

            if (status === 'OK') {
            resultsMap.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
                map: resultsMap,
                zoom: 10,
                position: results[0].geometry.location
            });
            } else {
            alert('Geocode was not successful for the following reason: ' + status);
            }
        });
        maploaded = true;
        };

    $("#submitajax").on("click", function(event) {
            event.preventDefault();

            console.log(addressquery);

            console.log(stateInput);

        var PPqueryURL = "https://api.propublica.org/congress/v1/members/senate/" + stateInput + "/current.json";

            console.log(PPqueryURL);

            $.ajax({
                url: PPqueryURL,
                headers: {
                "X-API-Key": "TQ2hslbjh61kVID2GwEOjzuQ8BzIauJScUHBfzJa"
                },

                method: "GET",
                
                crossDomain: true
                

            }).then(function(response) {
                var party = "";
            // Log the queryURL
            console.log(response);
            console.log(response.results);

            for (i=0; i<response.results.length; i++) {
                console.log(response.results[i]);
                console.log("Name: " + response.results[i].name);
                console.log("URID: " + response.results[i].id);
                if (response.results[i].party === "D") {
                    party = "Democrat";
                console.log("Party: Democrat");
                }
                else if (response.results[i].party === "R") {
                    party = "Republican";
                console.log("Party: Republican");
                }
                else {
                console.log("This is America you free thinking wackjob...");
                }

                console.log("Twitter Handle: " + response.results[i].twitter_id);
                console.log("Up for re-election: " + response.results[i].next_election);
                

            var newrow = $("<div>").addClass("row");

            (newrow).html('<div class="col-sm-3">' + response.results[i].name + '</div><div class="col-sm-3">' + response.results[i].role + '</div><div class="col-sm-3">' + party + '</div><div class="col-sm-3">' + response.results[i].next_election + '</div>')
                
            $("#dumpsite").prepend(newrow);

            };

        });

    });
           




    $("#submitajax2").on("click", function(event) {
            event.preventDefault();

            console.log(addressquery);

            console.log("Latitude: " + latitude + " and Longitude: " + longitude);


            var OSqueryurl = "https://cors-anywhere.herokuapp.com/https://openstates.org/api/v1/legislators/geo/?lat=" + latitude + "&long=" + longitude + "&apikey=" + OSAPIKey;


            $.ajax({
                url: OSqueryurl,
                headers: {
                    "X-API-Key": "61090add-67ca-4358-841d-7983d3231aa0",
                    },

                method: "GET"
            })

                .then(function(instance) {

                    console.log(instance)

                    stateInput = (instance[0].state);



                    // for (i=0; i<instance.length; i++) {
                        for (i=0; i<instance.length; i++) {

                            console.log(instance[i]);
                            console.log("Name: " + instance[i].full_name);
                            console.log("URID: " + instance[i].id);
                            console.log("Party: " + instance[i].party);


                            console.log("Emali: " + instance[i].email);
                            console.log("District: " + instance[i].district);
                            console.log("Office Address: " + instance[i].office_address);
                            console.log("Image REF: " + instance[i].photo_url);

                            var newrow = $("<div>").addClass("row");

                            var newimage = $("<img>");

                            newimage.attr("src", instance[i].photo_url).attr("style", "width: 180px");

                            console.log(newimage);


                            (newrow).html('<div class="col-sm-3">' + newimage[0].outerHTML + '</div><div class="col-sm-3">' + instance[i].full_name + '</div><div class="col-sm-3">' + instance[i].party + '</div><div class="col-sm-3">District: ' + instance[i].district + '</div>')
                                
                            $("#dumpsite").append(newrow);

                            


                        };
                    });


      });



</script>
    
</body>
</html>